# ==============================================================================
# Photon Environment Variables
# Copy this file to .env and fill in the values.
# Variables with defaults shown can be omitted for local development.
# ==============================================================================

# --- General ------------------------------------------------------------------

NODE_ENV=development

# Base URL of the API server
# ROOT_URL=http://localhost:4000

# URL of the Kvark frontend
# WEBSITE_URL=http://localhost:3000

# Port for the API server (default: 4000)
# PORT=4000

# Webhook URL for Photon callbacks (defaults to ROOT_URL)
# Useful when using ngrok or similar for local development
# WEBHOOK_URL=

# --- Docker (used by docker-compose) -----------------------------------------

POSTGRES_USER=postgres
POSTGRES_PASSWORD=password
POSTGRES_DB=photon_dev_db

# --- Database -----------------------------------------------------------------

DATABASE_URL=postgresql://postgres:password@localhost:5432/photon_dev_db

# Seed the database with test data on startup (when DB is empty)
SEED_DB=true

# Redis connection URL (default: redis://localhost:6379)
# REDIS_URL=redis://localhost:6379

# --- S3-Compatible Storage ----------------------------------------------------
# Local development uses MinIO (started via docker:dev).
# Production uses OpenStack Swift.

# MinIO (local dev):
S3_ENDPOINT=localhost:9000
S3_ACCESS_KEY_ID=minioadmin
S3_SECRET_ACCESS_KEY=minioadmin
S3_BUCKET_NAME=photon-files
S3_REGION=us-east-1
S3_USE_SSL=false
S3_FORCE_PATH_STYLE=true

# OpenStack Swift (production):
# S3_ENDPOINT=object.trd1.stack.it.ntnu.no
# S3_ACCESS_KEY_ID=<openstack-application-credential-id>
# S3_SECRET_ACCESS_KEY=<openstack-application-credential-secret>
# S3_BUCKET_NAME=photon-files
# S3_REGION=TRD1
# S3_USE_SSL=true
# S3_FORCE_PATH_STYLE=false

# --- Feide (OAuth login) -----------------------------------------------------

FEIDE_CLIENT_ID=
FEIDE_CLIENT_SECRET=

# --- Email --------------------------------------------------------------------
#
# How email delivery works:
#
#   LOCAL DEV (default, no config needed):
#     Emails are sent to Mailpit (started via docker:dev).
#     View inbox at http://localhost:8025
#
#   PRODUCTION (via Cloudflare Worker proxy):
#     The API queues emails via BullMQ. The email worker sends them
#     to a Cloudflare Worker (apps/proxy) over HTTP, which relays
#     them via SMTP. Set EMAIL_PROXY_URL + EMAIL_PROXY_KEY below.
#
#   DIRECT SMTP (alternative, no proxy):
#     Set the MAIL_* variables below to send directly via SMTP
#     from the API server (skipped when EMAIL_PROXY_URL is set).
#

# -- Email API (POST /api/email/send) --
# API key that external services use to send emails through the API.
# Pick any secret string. Requests must pass it as: Authorization: Bearer <key>
# EMAIL_API_KEY=

# -- Email Proxy (production) --
# When both are set, the email worker routes emails through the CF Worker proxy
# instead of sending via direct SMTP.
# EMAIL_PROXY_URL=https://photon-email-proxy.<subdomain>.workers.dev
# EMAIL_PROXY_KEY=<shared-secret-matching-the-proxy>

# -- Direct SMTP (dev/fallback) --
# Used when EMAIL_PROXY_URL is NOT set and you want real email delivery.
# In local dev, leave these unset — Mailpit handles it automatically.
# MAIL_HOST=smtp.example.com
# MAIL_PORT=587
# MAIL_USER=
# MAIL_PASS=
# MAIL_FROM=no-reply@tihlde.org

# --- Email Proxy Worker (apps/proxy) -----------------------------------------
# These are only needed when running or deploying the Cloudflare Worker proxy.
# The proxy reads MAIL_* and EMAIL_PROXY_KEY from above via alchemy.run.ts.
#
# One-time setup: cd apps/proxy && npx alchemy login
#
# Alchemy state encryption password (any random string):
# ALCHEMY_PASSWORD=<random-string>

# --- Vipps MobilePay ----------------------------------------------------------

VIPPS_TEST_MODE=true
# VIPPS_SUBSCRIPTION_KEY=
# VIPPS_CLIENT_ID=
# VIPPS_CLIENT_SECRET=
# VIPPS_MERCHANT_SERIAL_NUMBER=

# Refresh Vipps webhooks on startup (DO NOT enable in local dev — causes rate limiting)
# REFRESH_VIPPS_WEBHOOKS=false

# --- Misc ---------------------------------------------------------------------

# Max parallel test workers (default: 1)
# MAX_TEST_WORKERS=1

# The IP address the docker container will bind to (default: 127.0.0.1)
# BINDING_IP_ADDRESS=127.0.0.1
